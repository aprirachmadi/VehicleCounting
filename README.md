# Vehicle Detection and Counting System using YOLOv8

This project implements a multi-gate vehicle detection system using the YOLOv8 model. The system tracks and counts vehicles as they pass through predefined gates in a video. The project leverages pretrained YOLOv8 weights for object detection and tracking.

## Environment Setup
- Runtime: Kaggle Notebook
- CUDA Device: Tesla T4
- Python version: 3.10.13

## Project Structure

```plaintext
VehicleCounting/
│
├── src/
│   ├── vehicle_detection_and_counting.py               # Main script for vehicle detection
│   └── __init__.py                        # (optional) Makes `src` a package
│
├── notebooks/
│   └── vehicle-detection-and-counting.ipynb   # Jupyter notebook version of the project
│
├── data/
│   └── toll_gate.mp4                    # Sample video for testing
│
├── output/
│   └── output_multi_gate_vehicle_detection.mp4  # Output video generated by the script
│
├── requirements.txt                       # List of dependencies for the project
├── README.md                              # Project documentation
└── .gitignore                             # Files and directories to ignore in Git
```

## Requirements
Before running the project, ensure you have the following dependencies installed:
Python version 3.10.13
Make sure use python version bellow 3.12 for the supervision 0.14.0 to work
```
ultralytics==8.2.77
supervision==0.14.0
opencv-python-headless==4.10.0.84
numpy==1.26.4
torch==2.1.2
pillow==10.4.0
torchvision
pandas
```

You can install these dependencies using the following command:
```
pip install -r requirements.txt
```

## How to Run
1. Clone the Repository
Clone this repository to your local machine:
```
git clone https://github.com/aprirachmadi/VehicleCounting.git
cd VehicleCounting
```

2. Place Your Input Video
Place the input video file (.mp4 format) into the data/ directory. The default name expected is toll_gate.mp4. If your file has a different name, you will need to modify the script accordingly.

3. Run the Python Script
Execute the vehicle detection script:
```
python src/vehicle_detection_and_counting.py
```
This script will process the video and generate an output video with vehicle detections and gate crossing counts. The output video will be saved in the output/ directory as output_multi_gate_vehicle_detection.mp4.

3. Run the Python Notebook (Alternative)

Open and run the vehicle detection notebook:

Navigate to the notebooks/ directory and open the vehicle-detection-and-counting.ipynb file using Jupyter Notebook, Jupyter Lab, or any compatible environment.
Run each cell sequentially by selecting the cell and clicking the "Run" button or pressing Shift + Enter. The notebook will process the video, display annotated frames with detected vehicles, and show the gate crossing counts.

Ensure that all required dependencies are installed, and modify the input video path if necessary.

4. Review the Output
After the script finishes running, you can find the processed video in the output/ directory. The video will display the vehicles detected and annotated with the gates they have crossed.

## Customization
1. Adjusting Gate Coordinates
If you need to change the gate positions, you can modify the coordinates in the vehicle_detection_and_counting.py script:
```
START_1, END_1 = sv.Point(10, 135), sv.Point(87, 151)
# ...
```
2. Add more gate
If you need to add more gate, you can modify the coordinates in the vehicle_detection_and_counting.py script:
```
START_1, END_1 = sv.Point(10, 135), sv.Point(87, 151) # Add your own define gate
# ...

gates = [
    (START_1, END_1),
    # ... # Add defined gate

crossed_objects = [defaultdict(bool) for _ in range(8)] # change the number of dictionary equal to number of gate
```
3. Add more vehicle or Classes
```
results = model.track(frame,  classes=[2, 5], conf=0.3, iou=0.5, persist=True, tracker="bytetrack.yaml") # Add class id on classes list
```
please refer to model.names to get the coresponding class id

4. Changing the Input Video Path
If your video file is in a different location or has a different name, update the video_path variable in the vehicle_detection_and_counting.py script:
```
video_path = "data/your_video_name.mp4"
```
